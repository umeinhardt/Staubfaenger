(function(){"use strict";let a=null,h=null,y=null;function A(c,r,o){const n=[],s=c.length;for(let t=0;t<s;t++){const e=c[t];let x=0,z=0,g=0;for(let f=0;f<s;f++){if(t===f)continue;const d=c[f],u=d.position.x-e.position.x,i=d.position.y-e.position.y,p=d.position.z-e.position.z,v=u*u+i*i+p*p+o*o;if(v<1e-10)continue;const M=Math.sqrt(v),m=r*e.mass*d.mass/v,l=1/M;x+=u*l*m,z+=i*l*m,g+=p*l*m}n.push({id:e.id,force:{x,y:z,z:g}})}return n}function j(c,r,o,n,s){if(!(!a||!h||!y))for(let t=c;t<r;t++){const e=a[t*3+0],x=a[t*3+1],z=a[t*3+2],g=h[t];let f=0,d=0,u=0;for(let i=0;i<o;i++){if(t===i)continue;const p=a[i*3+0],v=a[i*3+1],M=a[i*3+2],m=h[i],l=p-e,G=v-x,F=M-z,S=l*l+G*G+F*F+s*s;if(S<1e-10)continue;const D=Math.sqrt(S),q=n*g*m/S,w=1/D;f+=l*w*q,d+=G*w*q,u+=F*w*q}y[t*3+0]+=f,y[t*3+1]+=d,y[t*3+2]+=u}}self.onmessage=c=>{const{type:r}=c.data;if(r==="initSharedBuffers"){const{positions:o,masses:n,forces:s}=c.data;o&&n&&s&&(a=new Float64Array(o),h=new Float64Array(n),y=new Float64Array(s))}else if(r==="computeGravityShared"){const{start:o,end:n,numEntities:s,G:t,epsilon:e}=c.data;o!==void 0&&n!==void 0&&s!==void 0&&t!==void 0&&e!==void 0&&(j(o,n,s,t,e),self.postMessage({type:"gravityComplete"}))}else if(r==="computeGravity"){const{entities:o,G:n,epsilon:s,deltaTime:t}=c.data;if(o&&n!==void 0&&s!==void 0){const e=A(o,n,s);self.postMessage({type:"gravityResults",results:e,deltaTime:t})}}}})();
